version: '2'

services:
  scripts.api:
    image: eeslp/scripts.api
    build:
      context: ./src/Services/Scripts.API
      dockerfile: Dockerfile
    depends_on:
      - mysql.data
      - redis.cache
    ports:
     - "5001:80"
    environment:
     - "Database:ConnectionString=Server=mysql.data;Port=3306;Database=EESLP;Uid=root;Pwd=supersecret"
     - "RabbitMq:Hostname=rabbit.eventbus"
     - "Services:redis.cache=redis.cache"
  logging.api:
    image: eeslp/logging.api
    build:
      context: ./src/Services/Logging.API
      dockerfile: Dockerfile
    depends_on:
      - mysql.data
      - redis.cache
    ports:
     - "5002:80"
    environment:
     - "Database:ConnectionString=Server=mysql.data;Port=3306;Database=EESLP;Uid=root;Pwd=supersecret"
     - "RabbitMq:Hostname=rabbit.eventbus"
  mysql.data:
    image: eeslp/mysql.data
    environment: 
      MYSQL_DATABASE : EESLP
      MYSQL_ROOT_PASSWORD: supersecret
    build:
      context: ./src/Sql
      dockerfile: Dockerfile
    ports:
      - "3306:3306"
  rabbit.eventbus:
    image: "rabbitmq:3-management"
    hostname: "rabbitmq"
    environment:
      RABBITMQ_ERLANG_COOKIE: "ASDSGSKEDJLHXCAKGHJSC"
      RABBITMQ_DEFAULT_USER: "guest"
      RABBITMQ_DEFAULT_PASS: "guest"
      RABBITMQ_DEFAULT_VHOST: "/"
    ports:
      - "15672:15672"
      - "5672:5672"
  redis.cache:
    image: redis